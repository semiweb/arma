%table
  %thead
    %tr
      %th= 'NAME'
      %th= 'ENV'
      %th= 'PRECISION'
      %th= 'RESTART DATE'
      %th= 'BRANCH'
      %th= 'COMMIT SHA'
      %th= 'MESSAGE'
      %th= 'COMMIT DATE'
      %th= 'LOCAL DIFF/COMMITS'
      %th= 'BEHIND MASTER BY'
      %th= 'HISTORY'
      %th= 'CHANGELOG'
  %tbody
    - installations.each do |installation|
      - state = installation.states.last
      - uptodate = state.behind_by == 0 ? 'uptodate' : ''
      %tr{ class: "#{cycle('odd', 'even')} #{uptodate} #{installation.env}" }
        %td.name= installation.name
        %td= installation.env
        %td= installation.location == 'undefined' ? nil : installation.location

        = render '/shared/state', state: state

        %td.behind_by= state.behind_by
        %td= link_to image_tag('book.png'), application_installation_states_path(installation.application_id, installation)
        %td
          = link_to(image_tag('book.png'), application_installation_code_changelogs_path(installation.application_id, installation))
          %span.changelogs_count= installation.nb_changelogs_uncommitted


